#!/usr/bin/env tsx

import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function resetAndPopulateDatabase() {
  console.log('üöÄ Iniciando reset e popula√ß√£o do banco de dados...');
  
  try {
    // 1. Conectar ao banco
    await prisma.$connect();
    console.log('‚úÖ Conex√£o com banco estabelecida');
    
    // 2. LIMPAR TODAS AS TABELAS (em ordem correta devido √†s foreign keys)
    console.log('üßπ Limpando todas as tabelas...');
    
    await prisma.lead.deleteMany({});
    console.log('  ‚úÖ Leads deletados');
    
    await prisma.image.deleteMany({});
    console.log('  ‚úÖ Imagens deletadas');
    
    await prisma.property.deleteMany({});
    console.log('  ‚úÖ Propriedades deletadas');
    
    await prisma.user.deleteMany({});
    console.log('  ‚úÖ Usu√°rios deletados');
    
    console.log('üéâ Banco limpo com sucesso!');
    
    // 3. CRIAR USU√ÅRIOS
    console.log('üë• Criando usu√°rios...');
    
    const adminUser = await prisma.user.create({
      data: {
        email: 'admin@lopes.com',
        name: 'Admin Master',
        role: 'admin',
        phone: '(62) 99999-0000',
        isActive: true
      }
    });
    
    const corretorUser = await prisma.user.create({
      data: {
        email: 'corretor@lopes.com',
        name: 'Jo√£o Corretor',
        role: 'corretor',
        phone: '(62) 88888-8888',
        isActive: true
      }
    });
    
    const corretor2User = await prisma.user.create({
      data: {
        email: 'maria@lopes.com',
        name: 'Maria Corretora',
        role: 'corretor',
        phone: '(62) 77777-7777',
        isActive: true
      }
    });
    
    console.log('‚úÖ Usu√°rios criados:', {
      admin: adminUser.name,
      corretor1: corretorUser.name,
      corretor2: corretor2User.name
    });
    
    // 4. CRIAR PROPRIEDADES COMPLETAS
    console.log('üè† Criando propriedades completas...');
    
    // Propriedade 1: Apartamento Premium
    const property1 = await prisma.property.create({
      data: {
        title: 'Borges Landeiro Classic',
        description: 'Apartamentos exclusivos no cora√ß√£o do Setor Oeste com acabamento de luxo e localiza√ß√£o privilegiada.',
        fullDescription: 'O Borges Landeiro Classic representa o que h√° de mais moderno em empreendimentos residenciais em Goi√¢nia. Localizado no valorizado Setor Oeste, o projeto oferece apartamentos com acabamentos de primeira qualidade, incluindo piso porcelanato 80x80, bancadas em quartzo, cozinha gourmet integrada e automa√ß√£o residencial. O condom√≠nio conta com √°rea de lazer completa, incluindo piscina adulto e infantil, academia, sal√£o de festas, playground e quadra poliesportiva.',
        category: 'venda',
        type: 'Premium',
        propertyType: 'apartamento',
        authorId: corretorUser.id,
        location: 'Setor Oeste',
        state: 'Goi√¢nia',
        address: 'Rua T-10, 1234 - Setor Oeste',
        coordinates: { lat: -16.6869, lng: -49.2648 },
        bedrooms: 3,
        bathrooms: 2,
        suites: 1,
        parking: 2,
        area: '85m¬≤',
        balconyTypes: ['Varanda gourmet', 'Sacada privativa'],
        price: 'R$ 450.000',
        apartmentOptions: [
          {
            id: 'apt-1-1',
            bedrooms: 2,
            area: '75m¬≤',
            price: 'R$ 380.000',
            floor: 5,
            available: true,
            features: ['Varanda', 'Vista para o jardim'],
            unitType: 'Padr√£o',
            bathrooms: 2,
            suites: 0,
            parking: 1,
            balcony: 'Varanda 6m¬≤',
            description: 'Apartamento 2 quartos com varanda'
          },
          {
            id: 'apt-1-2',
            bedrooms: 3,
            area: '85m¬≤',
            price: 'R$ 450.000',
            floor: 8,
            available: true,
            features: ['Su√≠te master', 'Varanda gourmet'],
            unitType: 'Premium',
            bathrooms: 2,
            suites: 1,
            parking: 2,
            balcony: 'Varanda gourmet 12m¬≤',
            description: 'Apartamento 3 quartos com su√≠te master'
          }
        ],
        developer: 'Construtora Borges Landeiro',
        deliveryDate: 'Dezembro 2024',
        availability: 'Dispon√≠vel para visita',
        characteristics: ['Piscina adulto e infantil', 'Academia completa', 'Sal√£o de festas', 'Playground', 'Quadra poliesportiva', 'Portaria 24h'],
        locationBenefits: ['Pr√≥ximo ao shopping Flamboyant', 'Metr√¥ a 500m', 'Escolas particulares renomadas', 'Hospitais pr√≥ximos'],
        differentials: ['Acabamento premium', 'Automa√ß√£o residencial', 'Vista panor√¢mica', 'Localiza√ß√£o privilegiada'],
        status: 'ativo',
        isFeatured: true,
        isVisible: true
      }
    });
    
    // Propriedade 2: Cobertura de Luxo
    const property2 = await prisma.property.create({
      data: {
        title: 'Marista Sky Residences',
        description: 'Cobertura duplex com vista panor√¢mica de 360¬∞ da cidade, piscina privativa e √°rea gourmet completa.',
        fullDescription: 'Uma cobertura √∫nica no Setor Marista, oferecendo o que h√° de mais exclusivo em moradia urbana. Com 250m¬≤ distribu√≠dos em dois pavimentos, esta unidade conta com piscina privativa, sauna, √°rea gourmet com churrasqueira, jardim suspenso e vista panor√¢mica deslumbrante de Goi√¢nia. O acabamento inclui m√°rmore travertino, madeira de demoli√ß√£o, sistema de som ambiente e ilumina√ß√£o LED automatizada.',
        category: 'investimento',
        type: 'Exclusivo',
        propertyType: 'cobertura',
        authorId: corretor2User.id,
        location: 'Setor Marista',
        state: 'Goi√¢nia',
        address: 'Rua 9, 1234 - Setor Marista',
        coordinates: { lat: -16.6869, lng: -49.2648 },
        bedrooms: 4,
        bathrooms: 4,
        suites: 2,
        parking: 4,
        area: '250m¬≤',
        balconyTypes: ['Terra√ßo privativo', 'Jardim suspenso'],
        price: 'R$ 1.200.000',
        apartmentOptions: [],
        developer: 'Construtora Marista',
        deliveryDate: 'Pronto para morar',
        availability: 'Dispon√≠vel para visita',
        characteristics: ['Piscina privativa', 'Sauna', '√Årea gourmet', 'Jardim suspenso', 'Elevador privativo', 'Portaria 24h'],
        locationBenefits: ['Centro de Goi√¢nia', 'Shopping pr√≥ximo', 'Faculdades renomadas', 'Hospitais de refer√™ncia'],
        differentials: ['Vista panor√¢mica 360¬∞', 'Acabamento de luxo', 'Terra√ßo privativo', 'Localiza√ß√£o nobre'],
        status: 'ativo',
        isFeatured: true,
        isVisible: true
      }
    });
    
    // Propriedade 3: Casa de Alto Padr√£o
    const property3 = await prisma.property.create({
      data: {
        title: 'Casa Europa Garden',
        description: 'Casa t√©rrea de alto padr√£o com piscina, jardim paisag√≠stico e √°rea gourmet em condom√≠nio fechado.',
        fullDescription: 'Localizada no exclusivo condom√≠nio Jardim Europa Residence, esta casa representa o que h√° de melhor em moradia familiar. Com 280m¬≤ de √°rea constru√≠da em terreno de 500m¬≤, a resid√™ncia oferece amplos ambientes integrados, su√≠te master com closet e hidromassagem, piscina com cascata, jardim paisag√≠stico assinado e √°rea gourmet completa com forno a lenha. O condom√≠nio oferece seguran√ßa 24h, clube, quadras e √°rea verde preservada.',
        category: 'venda',
        type: 'Alto Padr√£o',
        propertyType: 'casa',
        authorId: corretorUser.id,
        location: 'Jardim Europa',
        state: 'Goi√¢nia',
        address: 'Rua das Palmeiras, 456 - Jardim Europa',
        coordinates: { lat: -16.6869, lng: -49.2648 },
        bedrooms: 4,
        bathrooms: 3,
        suites: 2,
        parking: 3,
        area: '280m¬≤',
        balconyTypes: ['√Årea gourmet', 'Jardim'],
        price: 'R$ 850.000',
        apartmentOptions: [],
        developer: 'Construtora Europa',
        deliveryDate: 'Pronto para morar',
        availability: 'Dispon√≠vel para visita',
        characteristics: ['Piscina com cascata', 'Jardim paisag√≠stico', '√Årea gourmet', 'Su√≠te master com hidromassagem', 'Closet walk-in'],
        locationBenefits: ['Condom√≠nio fechado', 'Seguran√ßa 24h', 'Clube social', '√Årea verde preservada'],
        differentials: ['Casa t√©rrea', 'Terreno amplo', 'Acabamento premium', 'Localiza√ß√£o nobre'],
        status: 'ativo',
        isFeatured: true,
        isVisible: true
      }
    });
    
    // Propriedade 4: Loft Moderno
    const property4 = await prisma.property.create({
      data: {
        title: 'University Loft Studios',
        description: 'Lofts modernos para jovens profissionais e estudantes, com conceito inovador e localiza√ß√£o estrat√©gica.',
        fullDescription: 'Pensado para a nova gera√ß√£o de profissionais e universit√°rios, o University Loft Studios oferece conceito inovador de moradia urbana no Setor Universit√°rio. Os lofts contam com p√© direito duplo, mezanino funcional, cozinha integrada e design contempor√¢neo. O empreendimento oferece coworking, lavanderia compartilhada, bike sharing, academia 24h e localiza√ß√£o estrat√©gica pr√≥xima √† UFG e principais corredores de transporte da cidade.',
        category: 'aluguel',
        type: 'Moderno',
        propertyType: 'loft',
        authorId: corretor2User.id,
        location: 'Setor Universit√°rio',
        state: 'Goi√¢nia',
        address: 'Rua 235, 1234 - Setor Universit√°rio',
        coordinates: { lat: -16.6869, lng: -49.2648 },
        bedrooms: 1,
        bathrooms: 1,
        suites: 0,
        parking: 1,
        area: '45m¬≤',
        balconyTypes: ['Sacada compacta'],
        price: 'R$ 1.200/m√™s',
        apartmentOptions: [
          {
            id: 'loft-1',
            bedrooms: 1,
            area: '45m¬≤',
            price: 'R$ 1.200/m√™s',
            floor: 3,
            available: true,
            features: ['P√© direito duplo', 'Mezanino'],
            unitType: 'Studio',
            bathrooms: 1,
            suites: 0,
            parking: 1,
            balcony: 'Sacada 3m¬≤',
            description: 'Loft studio com mezanino'
          }
        ],
        developer: 'Construtora University',
        deliveryDate: 'Mar√ßo 2024',
        availability: 'Dispon√≠vel para loca√ß√£o',
        characteristics: ['P√© direito duplo', 'Mezanino funcional', 'Coworking', 'Lavanderia compartilhada', 'Bike sharing', 'Academia 24h'],
        locationBenefits: ['Pr√≥ximo √† UFG', 'Transporte p√∫blico', 'Com√©rcio local', 'Universidades'],
        differentials: ['Design contempor√¢neo', 'Conceito inovador', 'Localiza√ß√£o estrat√©gica', 'Comodidades modernas'],
        status: 'ativo',
        isFeatured: false,
        isVisible: true
      }
    });
    
    console.log('‚úÖ Propriedades criadas:', {
      prop1: property1.title,
      prop2: property2.title,
      prop3: property3.title,
      prop4: property4.title
    });
    
    // 5. CRIAR IMAGENS PARA CADA PROPRIEDADE
    console.log('üñºÔ∏è Criando imagens...');
    
    // Imagens para Property 1
    await prisma.image.createMany({
      data: [
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=1200&h=600&fit=crop',
          type: 'banner',
          propertyId: property1.id
        },
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=600&fit=crop',
          type: 'gallery',
          propertyId: property1.id
        },
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=600&fit=crop',
          type: 'gallery',
          propertyId: property1.id
        },
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=800&fit=crop',
          type: 'floorplan',
          propertyId: property1.id
        }
      ]
    });
    
    // Imagens para Property 2
    await prisma.image.createMany({
      data: [
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=1200&h=600&fit=crop',
          type: 'banner',
          propertyId: property2.id
        },
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=600&fit=crop',
          type: 'gallery',
          propertyId: property2.id
        },
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=600&fit=crop',
          type: 'gallery',
          propertyId: property2.id
        },
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=800&fit=crop',
          type: 'floorplan',
          propertyId: property2.id
        }
      ]
    });
    
    // Imagens para Property 3
    await prisma.image.createMany({
      data: [
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=1200&h=600&fit=crop',
          type: 'banner',
          propertyId: property3.id
        },
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=600&fit=crop',
          type: 'gallery',
          propertyId: property3.id
        },
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=600&fit=crop',
          type: 'gallery',
          propertyId: property3.id
        },
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=800&fit=crop',
          type: 'floorplan',
          propertyId: property3.id
        }
      ]
    });
    
    // Imagens para Property 4
    await prisma.image.createMany({
      data: [
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=1200&h=600&fit=crop',
          type: 'banner',
          propertyId: property4.id
        },
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=600&fit=crop',
          type: 'gallery',
          propertyId: property4.id
        },
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=600&fit=crop',
          type: 'gallery',
          propertyId: property4.id
        },
        {
          url: 'https://images.unsplash.com/photo-1560448204-e02f11c3d0e2?w=800&h=800&fit=crop',
          type: 'floorplan',
          propertyId: property4.id
        }
      ]
    });
    
    console.log('‚úÖ Imagens criadas para todas as propriedades');
    
    // 6. CRIAR LEADS DE EXEMPLO
    console.log('üìû Criando leads...');
    
    await prisma.lead.createMany({
      data: [
        {
          name: 'Maria Silva',
          phone: '(62) 99999-1111',
          email: 'maria@email.com',
          propertyId: property1.id,
          ownerId: corretorUser.id,
          source: 'website',
          status: 'novo',
          notes: 'Interessada no apartamento 3 quartos, quer agendar visita'
        },
        {
          name: 'Jo√£o Santos',
          phone: '(62) 99999-2222',
          email: 'joao@email.com',
          propertyId: property2.id,
          ownerId: corretor2User.id,
          source: 'whatsapp',
          status: 'contatado',
          notes: 'Quer informa√ß√µes sobre financiamento da cobertura'
        },
        {
          name: 'Ana Costa',
          phone: '(62) 99999-3333',
          email: 'ana@email.com',
          propertyId: property3.id,
          ownerId: corretorUser.id,
          source: 'instagram',
          status: 'novo',
          notes: 'Interessada na casa, tem cachorro'
        },
        {
          name: 'Pedro Oliveira',
          phone: '(62) 99999-4444',
          email: 'pedro@email.com',
          propertyId: property4.id,
          ownerId: corretor2User.id,
          source: 'facebook',
          status: 'novo',
          notes: 'Estudante da UFG, procura loft pr√≥ximo √† universidade'
        },
        {
          name: 'Carla Mendes',
          phone: '(62) 99999-5555',
          email: 'carla@email.com',
          propertyId: property1.id,
          ownerId: corretorUser.id,
          source: 'website',
          status: 'interessado',
          notes: 'J√° visitou, est√° analisando proposta'
        }
      ]
    });
    
    console.log('‚úÖ Leads criados');
    
    // 7. VERIFICAR DADOS FINAIS
    const stats = await prisma.$transaction([
      prisma.user.count(),
      prisma.property.count(),
      prisma.image.count(),
      prisma.lead.count()
    ]);
    
    console.log('üìä ESTAT√çSTICAS FINAIS:');
    console.log(`  üë• Usu√°rios: ${stats[0]}`);
    console.log(`  üè† Propriedades: ${stats[1]}`);
    console.log(`  üñºÔ∏è Imagens: ${stats[2]}`);
    console.log(`  üìû Leads: ${stats[3]}`);
    
    console.log('üéâ BANCO DE DADOS RESETADO E POPULADO COM SUCESSO!');
    console.log('');
    console.log('üìã RESUMO DO QUE FOI CRIADO:');
    console.log('  üë§ 3 usu√°rios (1 admin + 2 corretores)');
    console.log('  üè† 4 propriedades completas:');
    console.log('    - Apartamento Premium (Setor Oeste)');
    console.log('    - Cobertura de Luxo (Setor Marista)');
    console.log('    - Casa Alto Padr√£o (Jardim Europa)');
    console.log('    - Loft Moderno (Setor Universit√°rio)');
    console.log('  üñºÔ∏è 16 imagens (4 por propriedade)');
    console.log('  üìû 5 leads de exemplo');
    console.log('');
    console.log('üîë CREDENCIAIS DE LOGIN:');
    console.log('  Admin: admin@lopes.com');
    console.log('  Corretor 1: corretor@lopes.com');
    console.log('  Corretor 2: maria@lopes.com');
    
  } catch (error) {
    console.error('‚ùå Erro ao resetar e popular banco:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

// Executar se chamado diretamente
if (require.main === module) {
  resetAndPopulateDatabase()
    .then(() => process.exit(0))
    .catch((error) => {
      console.error(error);
      process.exit(1);
    });
}

export { resetAndPopulateDatabase };
