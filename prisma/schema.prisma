// Prisma Schema - Sistema Imobiliário Lopes
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_URL")
}

// Tabela de usuários (corretores e admins)
model User {
  id         Int      @id @default(autoincrement())
  name       String
  email      String   @unique
  password   String
  role       String   @default("corretor") // "corretor" ou "admin"
  active     Boolean  @default(false)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  
  properties Property[]
  
  @@map("users")
}

// Tabela de propriedades
model Property {
  id                 Int      @id @default(autoincrement())
  title              String
  shortDescription   String?  @db.Text
  fullDescription    String?  @db.Text
  propertyType       String   // 'casa', 'apartamento', 'terreno', 'comercial'
  transactionType    String   // 'venda', 'aluguel', 'investimento'
  price              Decimal  @db.Decimal(12, 2)
  
  // Características
  bedrooms           Int      @default(0)
  bathrooms          Int      @default(0)
  suites             Int      @default(0)
  parkingSpaces      Int      @default(0)
  area               Decimal? @db.Decimal(10, 2)
  amenities          String[] // Array de vantagens
  
  // Imagens
  bannerImage        String?
  galleryImages      String[] // Até 15 imagens
  floorPlans         String[] // Plantas baixas
  apartmentVariants  Json?    // Para apartamentos com múltiplas plantas
  
  // Localização
  address            String?  @db.Text
  googleMapsIframe   String?  @db.Text
  
  // Status e destaque
  featured           Boolean  @default(false)
  visible            Boolean  @default(false) // Apenas admin pode mudar para true
  status             String   @default("draft")
  
  // Relacionamentos
  authorId           Int
  author             User     @relation(fields: [authorId], references: [id])
  
  leads              Lead[]
  
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
  
  @@map("properties")
}

// Tabela de leads
model Lead {
  id         Int      @id @default(autoincrement())
  name       String
  phone      String
  email      String?
  message    String?  @db.Text
  
  propertyId Int?
  property   Property? @relation(fields: [propertyId], references: [id])
  
  status     String   @default("new")
  createdAt  DateTime @default(now())
  
  @@map("leads")
}
