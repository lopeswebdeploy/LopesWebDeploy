import { Property } from "@/types/property";
import { AuthService } from "@/lib/auth";

export class PropertyService {
  // Carregar propriedades - APENAS do banco de dados
  static async loadProperties(): Promise<Property[]> {
    console.log('üîç PropertyService.loadProperties - Carregando propriedades do banco...');
    
    try {
      const response = await fetch('/api/properties');
      if (response.ok) {
        const properties = await response.json();
        console.log('‚úÖ PropertyService.loadProperties - Carregadas do banco:', properties.length, 'propriedades');
        return properties;
      }
      
      console.error('‚ùå PropertyService.loadProperties - Erro na API:', response.status);
      return [];
    } catch (error) {
      console.error('‚ùå PropertyService.loadProperties - Erro no banco:', error);
      return [];
    }
  }

  // Vers√£o s√≠ncrona para compatibilidade (retorna vazio - use loadProperties async)
  static loadPropertiesSync(): Property[] {
    console.log('üîç PropertyService.loadPropertiesSync - Retornando array vazio (use loadProperties async)');
    return [];
  }

  // Buscar propriedade por ID
  static async getPropertyById(id: string): Promise<Property | null> {
    console.log("üîç PropertyService.getPropertyById - Buscando ID:", id);
    
    try {
      const response = await fetch(`/api/properties/${id}`);
      if (response.ok) {
        const property = await response.json();
        console.log("‚úÖ PropertyService.getPropertyById - Propriedade encontrada:", property.title);
        return property;
      }
    } catch (error) {
      console.error("‚ùå PropertyService.getPropertyById - Erro:", error);
      return null;
    }
    
    console.log("‚ùå PropertyService.getPropertyById - Propriedade n√£o encontrada!");
    return null;
  }

  // Vers√£o s√≠ncrona para compatibilidade
  static getPropertyByIdSync(id: string): Property | null {
    return null;
  }

  // Adicionar propriedade
  static async addProperty(property: Property): Promise<Property> {
    console.log('üîç PropertyService.addProperty - Adicionando propriedade:', property.title);
    
    try {
      const response = await fetch('/api/properties', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(property),
      });
      
      if (response.ok) {
        const newProperty = await response.json();
        console.log('‚úÖ PropertyService.addProperty - Propriedade adicionada:', newProperty.id);
        return newProperty;
      }
      
      throw new Error(`Erro na API: ${response.status}`);
    } catch (error) {
      console.error('‚ùå PropertyService.addProperty - Erro:', error);
      throw error;
    }
  }

  // Atualizar propriedade
  static async updateProperty(property: Property): Promise<Property> {
    console.log('üîç PropertyService.updateProperty - Atualizando propriedade:', property.id);
    
    try {
      const response = await fetch(`/api/properties/${property.id}`, {
        method: 'PUT',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify(property),
      });
      
      if (response.ok) {
        const updatedProperty = await response.json();
        console.log('‚úÖ PropertyService.updateProperty - Propriedade atualizada:', updatedProperty.id);
        return updatedProperty;
      }
      
      throw new Error(`Erro na API: ${response.status}`);
    } catch (error) {
      console.error('‚ùå PropertyService.updateProperty - Erro:', error);
      throw error;
    }
  }

  // Excluir propriedade
  static async deleteProperty(id: string): Promise<void> {
    console.log('üîç PropertyService.deleteProperty - Excluindo propriedade:', id);
    
    try {
      const response = await fetch(`/api/properties/${id}`, {
        method: 'DELETE',
      });
      
      if (response.ok) {
        console.log('‚úÖ PropertyService.deleteProperty - Propriedade exclu√≠da:', id);
        return;
      }
      
      throw new Error(`Erro na API: ${response.status}`);
    } catch (error) {
      console.error('‚ùå PropertyService.deleteProperty - Erro:', error);
      throw error;
    }
  }

  // M√©todos de compatibilidade (para manter funcionalidade existente)
  static forceSampleData(): void {
    console.log('üîç PropertyService.forceSampleData - M√©todo n√£o implementado');
  }

  static exportData(): string {
    console.log('üîç PropertyService.exportData - M√©todo n√£o implementado');
    return '{}';
  }

  static async importData(data: string): Promise<boolean> {
    console.log('üîç PropertyService.importData - M√©todo n√£o implementado');
    return false;
  }

  static clearAllData(): void {
    console.log('üîç PropertyService.clearAllData - M√©todo n√£o implementado');
  }
}